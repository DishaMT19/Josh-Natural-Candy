<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Account - Josh Natural Candy</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Custom Account Page Styles */
        .account-header {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 3rem 0;
            margin-bottom: 2rem;
            border-bottom: 1px solid rgba(0,0,0,0.1);
        }
        
        .profile-card {
            transition: all 0.3s ease;
            border: none;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        .profile-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        
        .profile-img {
            width: 150px;
            height: 150px;
            object-fit: cover;
            border: 5px solid white;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .account-section {
            margin-bottom: 2rem;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
        }
        
        .account-section:hover {
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        
        .account-section .card-header {
            background-color: #6c757d;
            color: white;
            font-weight: 600;
            border-bottom: none;
        }
        
        .cart-item-img {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 5px;
        }
        
        
        .edit-profile-btn {
            position: relative;
            overflow: hidden;
        }
        
        .edit-profile-btn::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -60%;
            width: 200%;
            height: 200%;
            background: rgba(255,255,255,0.2);
            transform: rotate(30deg);
            transition: all 0.3s ease;
        }
        
        .edit-profile-btn:hover::after {
            left: 100%;
        }
        
        /* Animation for loading content */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-out forwards;
        }

        /* Payment processing animation */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        @keyframes paymentSuccess {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .processing-payment {
            animation: pulse 1.5s infinite;
            position: relative;
            overflow: hidden;
        }
        
        .processing-payment::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            animation: shimmer 2s infinite;
        }
        
        @keyframes shimmer {
            100% { left: 100%; }
        }
        
        .payment-success {
            animation: paymentSuccess 0.5s ease-out;
        }
        
        .payment-complete {
            background-color: #28a745 !important;
            border-color: #28a745 !important;
        }
        
        /* Credit card animation */
        .credit-card {
            perspective: 1000px;
            display: inline-block;
            margin: 0 10px;
        }
        
        .card-inner {
            width: 40px;
            height: 25px;
            position: relative;
            transform-style: preserve-3d;
            transition: all 0.8s ease;
        }
        
        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }
        
        .card-front {
            background: linear-gradient(135deg, #6e8efb, #a777e3);
            color: white;
        }
        
        .card-back {
            background: linear-gradient(135deg, #f093fb, #f5576c);
            color: white;
            transform: rotateY(180deg);
        }
        
        .flipped {
            transform: rotateY(180deg);
        }

        /* New styles for edit mode */
        .edit-mode {
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            border: 1px dashed #dee2e6;
        }
        
        .edit-mode input, .edit-mode textarea {
            margin-bottom: 10px;
        }
        
        /* Map container style */
        #mapContainer {
            height: 300px;
            width: 100%;
            margin-top: 15px;
            border-radius: 8px;
            overflow: hidden;
            display: none;
        }
        
        #map {
            height: 100%;
        }
        
        /* Order details modal */
        .order-item {
            display: flex;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .order-item-img {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 5px;
            margin-right: 15px;
        }
        
        
        /* Quantity input styles */
        .quantity-controls {
            display: flex;
            align-items: center;
        }
        
        .quantity-value {
            width: 50px;
            text-align: center;
            margin: 0 5px;
        }
        
        /* Validation error styles */
        .is-invalid {
            border-color: #dc3545 !important;
        }
        
        .invalid-feedback {
            color: #dc3545;
            font-size: 0.875em;
            margin-top: -10px;
            margin-bottom: 10px;
        }

        /* Loader styles */
        .loader-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s ease;
        }
        
        .loader {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .loader-popsicle {
            width: 20px;
            height: 60px;
            background: linear-gradient(to bottom, #ff6b6b, #ff8e8e);
            border-radius: 10px;
            animation: loaderPopsicle 1s ease-in-out infinite alternate;
        }
        
        .loader-popsicle:nth-child(2) {
            animation-delay: 0.2s;
            background: linear-gradient(to bottom, #4ecdc4, #88f0ea);
        }
        
        .loader-popsicle:nth-child(3) {
            animation-delay: 0.4s;
            background: linear-gradient(to bottom, #ffe66d, #fff19e);
        }
        
        @keyframes loaderPopsicle {
            0% { transform: translateY(0); }
            100% { transform: translateY(-20px); }
        }
        
        .loader-logo {
            font-family: 'Arial', sans-serif;
            font-size: 24px;
            font-weight: bold;
            color: #333;
            margin-top: 20px;
        }

        /* Navbar styles */
        .navbar {
            background-color: #fff;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .navbar-brand {
            font-weight: 700;
            color: #6c757d;
        }
        
        .navbar-brand i {
            color: #ff6b6b;
        }
        
        .nav-link {
            font-weight: 500;
            color: #6c757d;
        }
        
        .nav-link.active {
            color: #495057;
            font-weight: 600;
        }
        
        /* Footer styles */
        footer {
            background-color: #343a40;
        }
        
        .footer-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: #fff;
        }
        
        .footer-links {
            list-style: none;
            padding: 0;
        }
        
        .footer-links li {
            margin-bottom: 0.5rem;
        }
        
        .footer-links a {
            color: rgba(255,255,255,0.7);
            text-decoration: none;
            transition: color 0.3s;
        }
        
        .footer-links a:hover {
            color: #fff;
        }
        
        .social-icons a {
            display: inline-block;
            width: 36px;
            height: 36px;
            background-color: rgba(255,255,255,0.1);
            color: #fff;
            border-radius: 50%;
            text-align: center;
            line-height: 36px;
            margin-right: 8px;
            transition: all 0.3s;
        }
        
        .social-icons a:hover {
            background-color: rgba(255,255,255,0.2);
            transform: translateY(-3px);
        }
        
        .newsletter-form .input-group {
            max-width: 400px;
        }
    </style>
</head>
<body>
    <!-- Loader -->
    <div class="loader-container" id="loader">
        <div class="loader">
            <div class="loader-popsicle"></div>
            <div class="loader-popsicle"></div>
            <div class="loader-popsicle"></div>
        </div>
        <div class="loader-logo">Josh Natural Candy</div>
    </div>

    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg sticky-top">
        <div class="container">
             <a class="navbar-brand" href="">
                <i class="fas fa-ice-cream me-2"></i> Josh Natural Candy
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="index.html">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="index.html#flavors">Flavors</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="account.html"><i class="fas fa-user me-1"></i> My Account</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Account Header -->
    <div class="account-header text-center">
        <div class="container">
            <h1 class="display-4 fw-bold">My Account</h1>
            <p class="lead">Manage your profile, orders, and preferences</p>
        </div>
    </div>

    <!-- Main Content -->
    <div class="container py-5">
        <div class="row">
            <!-- Profile Column -->
            <div class="col-lg-4 mb-4">
                <div class="card profile-card h-100">
                    <div class="card-body text-center p-4">
                        <div class="position-relative d-inline-block">
                            <img src="https://ui-avatars.com/api/?name=J+NC&background=random&size=150&rounded=true" 
                                 alt="User" 
                                 class="profile-img mb-3"
                                 id="accountUserImg">
                            <button class="btn btn-sm btn-primary position-absolute bottom-0 end-0 rounded-circle"
                                    style="width: 40px; height: 40px;"
                                    id="changePhotoBtn">
                                <i class="fas fa-camera"></i>
                            </button>
                        </div>
                        <h3 class="mb-2" id="accountUserName">Guest</h3>
                        <p class="text-muted mb-3" id="accountUserEmail">Not logged in</p>
                        <div class="d-grid gap-2">
                            <button class="btn btn-primary edit-profile-btn" id="editProfileBtn">
                                <i class="fas fa-user-edit me-2"></i> Edit Profile
                            </button>
                            <button class="btn btn-outline-danger" id="logoutBtn">
                                <i class="fas fa-sign-out-alt me-2"></i> Logout
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Content Column -->
            <div class="col-lg-8">
                <!-- Account Details Card -->
                <div class="card account-section mb-4">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <span><i class="fas fa-user-circle me-2"></i> Account Details</span>
                        <button class="btn btn-sm btn-outline-light" id="editDetailsBtn">
                            <i class="fas fa-edit me-1"></i> Edit
                        </button>
                    </div>
                    <div class="card-body">
                        <div id="accountDetailsView">
                            <div class="row mb-3">
                                <div class="col-md-4 fw-bold">Full Name</div>
                                <div class="col-md-8" id="accountFullName">-</div>
                            </div>
                            <div class="row mb-3">
                                <div class="col-md-4 fw-bold">Email</div>
                                <div class="col-md-8" id="accountEmail">-</div>
                            </div>
                            <div class="row mb-3">
                                <div class="col-md-4 fw-bold">Phone</div>
                                <div class="col-md-8" id="accountPhone">-</div>
                            </div>
                            <div class="row">
                                <div class="col-md-4 fw-bold">Address</div>
                                <div class="col-md-8" id="accountAddress">-</div>
                            </div>
                        </div>
                        
                        <div id="accountDetailsEdit" style="display: none;">
                            <div class="edit-mode">
                                <div class="mb-3">
                                    <label class="form-label">Full Name</label>
                                    <input type="text" class="form-control" id="editFullName" required>
                                    <div class="invalid-feedback">Please enter your full name</div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Email</label>
                                    <input type="email" class="form-control" id="editEmail" required>
                                    <div class="invalid-feedback">Please enter a valid email</div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Phone</label>
                                    <input type="tel" class="form-control" id="editPhone" pattern="[0-9]{10}" required>
                                    <div class="invalid-feedback">Please enter a 10-digit phone number</div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Address</label>
                                    <textarea class="form-control" id="editAddress" rows="2" required></textarea>
                                    <div class="invalid-feedback">Please enter your address</div>
                                </div>
                                <div class="d-flex justify-content-end">
                                    <button class="btn btn-outline-secondary me-2" id="cancelEditBtn">
                                        Cancel
                                    </button>
                                    <button class="btn btn-primary" id="saveEditBtn">
                                        Save Changes
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Cart Section -->
                <div class="card account-section mb-4">
                    <div class="card-header">
                        <i class="fas fa-shopping-cart me-2"></i> Your Cart
                        <span class="badge bg-primary ms-2" id="cartItemCount">0</span>
                    </div>
                    <div class="card-body" id="accountCartItems">
                        <div class="text-center py-4">
                            <i class="fas fa-shopping-cart fa-3x text-muted mb-3"></i>
                            <p class="text-muted">Your cart is empty</p>
                            <a href="index.html#flavors" class="btn btn-outline-primary">
                                <i class="fas fa-ice-cream me-2"></i> Browse Flavors
                            </a>
                        </div>
                    </div>
                    <div class="card-footer bg-transparent border-top-0 text-end">
                        <button class="btn btn-primary" id="accountCheckoutBtn" disabled>
                            <span class="button-content">
                                <i class="fas fa-credit-card me-2"></i> Proceed to Pay
                            </span>
                            <span class="payment-animation" style="display: none;">
                                <span class="credit-card">
                                    <span class="card-inner">
                                        <span class="card-front">••••</span>
                                        <span class="card-back">CVV</span>
                                    </span>
                                </span>
                                Processing your payment...
                            </span>
                            <span class="payment-success" style="display: none;">
                                <i class="fas fa-check-circle me-2"></i> Payment Successful!
                            </span>
                        </button>
                    </div>
                </div>

            
            </div>
        </div>
    </div>

    

    <!-- Order Details Modal -->
    <div class="modal fade" id="orderDetailsModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-receipt me-2"></i> Order Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="orderDetailsContent">
                    <!-- Content will be loaded dynamically -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Address Modal -->
    <div class="modal fade" id="addressModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-map-marker-alt me-2"></i> Delivery Address</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">Full Address</label>
                        <textarea class="form-control" id="deliveryAddress" rows="3" required></textarea>
                        <div class="invalid-feedback">Please enter your delivery address</div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Landmark (Optional)</label>
                        <input type="text" class="form-control" id="deliveryLandmark">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="confirmAddressBtn">Confirm Address</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer-->
    <footer class="py-5 bg-dark text-white">
        <div class="container">
            <div class="row">
                <div class="col-lg-4 mb-4 mb-lg-0">
                    <h5 class="footer-title">Josh Natural Candy</h5>
                    <p>Handcrafted artisanal popsicles made with real fruit and natural ingredients.</p>
                    <div class="social-icons">
                        <a href="#"><i class="fab fa-facebook-f"></i></a>
                        <a href="#"><i class="fab fa-twitter"></i></a>
                        <a href="#"><i class="fab fa-instagram"></i></a>
                    </div>
                </div>
                <div class="col-lg-2 col-md-6 mb-4 mb-md-0">
                    <h5 class="footer-title">Quick Links</h5>
                    <ul class="footer-links">
                        <li><a href="index.html">Home</a></li>
                        <li><a href="index.html#flavors">Flavors</a></li>
                        <li><a href="account.html">My Account</a></li>
                    </ul>
                </div>
                <div class="col-lg-4">
                    <h5 class="footer-title">Newsletter</h5>
                    <p>Subscribe for updates on new flavors and specials</p>
                    <form class="newsletter-form">
                        <div class="input-group">
                            <input type="email" class="form-control" placeholder="Your email" required>
                            <button class="btn btn-primary" type="submit">Subscribe</button>
                        </div>
                    </form>
                </div>
            </div>
            <hr class="my-4">
            <div class="row">
                <div class="col-md-6 text-center text-md-start">
                    <p class="mb-0">&copy; 2023 Josh Natural Candy. All rights reserved.</p>
                </div>
                <div class="col-md-6 text-center text-md-end">
                    <p class="mb-0">Made with <i class="fas fa-heart text-danger"></i> by Josh Team</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Bootstrap JS Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Hide loader
        window.addEventListener('load', function() {
            setTimeout(function() {
                document.getElementById('loader').style.opacity = '0';
                setTimeout(function() {
                    document.getElementById('loader').style.display = 'none';
                }, 500);
            }, 1000);
        });

        document.addEventListener('DOMContentLoaded', function() {
            let user = JSON.parse(localStorage.getItem('loggedInUser')) || {};
            let cart = JSON.parse(localStorage.getItem('cart')) || [];
            let allOrders = JSON.parse(localStorage.getItem('orders')) || [];
            let orders = allOrders.filter(order => order.userEmail === user.email);
            let map, addressMarker;
           
            // Update user info
            function updateUserInfo() {
                if (user && user.email) {
                    document.getElementById('accountUserName').textContent = user.name || 'User';
                    document.getElementById('accountUserEmail').textContent = user.email || 'No email';
                    document.getElementById('accountFullName').textContent = user.name || '-';
                    document.getElementById('accountEmail').textContent = user.email || '-';
                    document.getElementById('accountPhone').textContent = user.phone || '-';
                    document.getElementById('accountAddress').textContent = user.address || '-';
                    
                    // Generate profile image if not exists
                    if (!user.image) {
                        const name = user.name ? user.name.replace(/\s+/g, '+') : 'User';
                        document.getElementById('accountUserImg').src = `https://ui-avatars.com/api/?name=${name}&background=random&size=150&rounded=true`;
                    }
                } else {
                    // Redirect to login if not logged in
                    window.location.href = 'index.html';
                }
            }
            
            updateUserInfo();

            // Initialize edit mode
            function initEditMode() {
                document.getElementById('editFullName').value = user.name || '';
                document.getElementById('editEmail').value = user.email || '';
                document.getElementById('editPhone').value = user.phone || '';
                document.getElementById('editAddress').value = user.address || '';
                
                // Clear validation errors
                document.querySelectorAll('.is-invalid').forEach(el => el.classList.remove('is-invalid'));
            }

            // Render cart items
            function renderCartItems() {
                const accountCartItems = document.getElementById('accountCartItems');
                if (cart.length > 0) {
                    let html = '';
                    const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                    const tax = subtotal * 0.1; // 10% tax
                    const serviceCharge = 15; // Rs.15 service charge
                    const total = subtotal + tax + serviceCharge;
                    
                    cart.forEach(item => {
                        html += `
                            <div class="row mb-3 align-items-center fade-in">
                                <div class="col-md-2">
                                    <img src="${item.image}" alt="${item.name}" class="img-fluid rounded cart-item-img">
                                </div>
                                <div class="col-md-4">
                                    <h6 class="mb-1">${item.name}</h6>
                                    <p class="text-muted mb-0">₹${parseFloat(item.price).toFixed(2)}</p>

                                </div>
                                <div class="col-md-3">
                                <div class="quantity-controls">
                                    <button class="btn btn-outline-secondary decrease-quantity" type="button" data-id="${item.id}">
                                    <i class="fas fa-minus"></i>
                                    </button>
                                    <input type="text" class="form-control text-center quantity-value" value="${item.quantity}" readonly>
                                    <button class="btn btn-outline-secondary increase-quantity" type="button" data-id="${item.id}">
                                    <i class="fas fa-plus"></i>
                                    </button>
                                </div>
                                <small class="text-muted">Min 10</small>
                                </div>

                                <div class="col-md-3 text-end">
                                    <p class="mb-1">₹${(item.price * item.quantity).toFixed(2)}</p>
                                    <button class="btn btn-sm btn-outline-danger remove-item" data-id="${item.id}">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                            <hr class="my-2">
                        `;
                    });
                    
                    html += `
                        <div class="row fade-in">
                            <div class="col-md-6">
                                <p>Subtotal:</p>
                                <p>Tax (10%):</p>
                                <p>Service Charge:</p>
                                <p class="fw-bold">Total:</p>
                            </div>
                            <div class="col-md-6 text-end">
                                <p>₹${subtotal.toFixed(2)}</p>
                                <p>₹${tax.toFixed(2)}</p>
                                <p>₹${serviceCharge.toFixed(2)}</p>
                                <p class="fw-bold">₹${total.toFixed(2)}</p>
                            </div>
                        </div>
                    `;
                    
                    accountCartItems.innerHTML = html;
                    document.getElementById('accountCheckoutBtn').disabled = false;
                    document.getElementById('cartItemCount').textContent = cart.reduce((sum, item) => sum + item.quantity, 0);
                } else {
                    accountCartItems.innerHTML = `
                        <div class="text-center py-4">
                            <i class="fas fa-shopping-cart fa-3x text-muted mb-3"></i>
                            <p class="text-muted">Your cart is empty</p>
                            <a href="index.html#flavors" class="btn btn-outline-primary">
                                <i class="fas fa-ice-cream me-2"></i> Browse Flavors
                            </a>
                        </div>
                    `;
                    document.getElementById('accountCheckoutBtn').disabled = true;
                    document.getElementById('cartItemCount').textContent = '0';
                }
            }
            
            renderCartItems();

            // Render order history
            function renderOrderHistory() {
                const accountOrderHistory = document.getElementById('accountOrderHistory');
                if (orders.length > 0) {
                    let html = '';
                    orders.forEach(order => {
                        html += `
                            <div class="card mb-3 fade-in">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between">
                                        <div>
                                            <h6 class="mb-1">Order #${order.id}</h6>
                                            <p class="text-muted small">${new Date(order.date).toLocaleDateString()}</p>
                                        </div>
                                        <div class="text-end">
                                            <p class="mb-1 fw-bold">₹${order.total.toFixed(2)}</p>
                                            <span class="badge ${order.status === 'Delivered' ? 'bg-success' : order.status === 'Cancelled' ? 'bg-danger' : 'bg-warning text-dark'}">
                                                ${order.status}
                                            </span>
                                        </div>
                                    </div>
                                    <button class="btn btn-sm btn-outline-primary mt-2 view-order-details" data-id="${order.id}">
                                        <i class="fas fa-eye me-1"></i> View Details
                                    </button>
                                </div>
                            </div>
                        `;
                    });
                    accountOrderHistory.innerHTML = html;
                } 
                
            }
            
            renderOrderHistory();

           

            // Validate form fields
            function validateForm() {
                let isValid = true;
                
                const fullName = document.getElementById('editFullName');
                if (!fullName.value.trim()) {
                    fullName.classList.add('is-invalid');
                    isValid = false;
                } else {
                    fullName.classList.remove('is-invalid');
                }
                
                const email = document.getElementById('editEmail');
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(email.value)) {
                    email.classList.add('is-invalid');
                    isValid = false;
                } else {
                    email.classList.remove('is-invalid');
                }
                
                const phone = document.getElementById('editPhone');
                const phoneRegex = /^\d{10}$/;
                if (!phoneRegex.test(phone.value)) {
                    phone.classList.add('is-invalid');
                    isValid = false;
                } else {
                    phone.classList.remove('is-invalid');
                }
                
                const address = document.getElementById('editAddress');
                if (!address.value.trim()) {
                    address.classList.add('is-invalid');
                    isValid = false;
                } else {
                    address.classList.remove('is-invalid');
                }
                
                return isValid;
            }

            // Toggle edit mode
            document.getElementById('editDetailsBtn').addEventListener('click', function() {
                document.getElementById('accountDetailsView').style.display = 'none';
                document.getElementById('accountDetailsEdit').style.display = 'block';
                initEditMode();
            });
            
            // Cancel edit
            document.getElementById('cancelEditBtn').addEventListener('click', function() {
                document.getElementById('accountDetailsView').style.display = 'block';
                document.getElementById('accountDetailsEdit').style.display = 'none';
                document.getElementById('mapContainer').style.display = 'none';
            });
            
            // Save edit
            document.getElementById('saveEditBtn').addEventListener('click', function() {
                if (!validateForm()) {
                    return;
                }
                
                user.name = document.getElementById('editFullName').value;
                user.email = document.getElementById('editEmail').value;
                user.phone = document.getElementById('editPhone').value;
                user.address = document.getElementById('editAddress').value;
                
                localStorage.setItem('loggedInUser', JSON.stringify(user));
                updateUserInfo();
                
                document.getElementById('accountDetailsView').style.display = 'block';
                document.getElementById('accountDetailsEdit').style.display = 'none';
                document.getElementById('mapContainer').style.display = 'none';
                
                // Show success message
                const toast = document.createElement('div');
                toast.className = 'position-fixed bottom-0 end-0 p-3';
                toast.style.zIndex = '11';
                toast.innerHTML = `
                    <div class="toast show" role="alert" aria-live="assertive" aria-atomic="true">
                        <div class="toast-header bg-success text-white">
                            <strong class="me-auto">Success</strong>
                            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast" aria-label="Close"></button>
                        </div>
                        <div class="toast-body">
                            Profile updated successfully!
                        </div>
                    </div>
                `;
                document.body.appendChild(toast);
                
                setTimeout(() => {
                    toast.remove();
                }, 3000);
            });

            // Quantity buttons
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('decrease-quantity') || e.target.closest('.decrease-quantity')) {
                    const button = e.target.classList.contains('decrease-quantity') ? e.target : e.target.closest('.decrease-quantity');
                    const productId = parseInt(button.getAttribute('data-id'));
                    const item = cart.find(item => item.id === productId);
                    
                    if (item.quantity > 10) {
                        item.quantity += 1;
                        localStorage.setItem('cart', JSON.stringify(cart));
                        renderCartItems();
                    } else {
                        // Show error message for minimum quantity
                        const toast = document.createElement('div');
                        toast.className = 'position-fixed bottom-0 end-0 p-3';
                        toast.style.zIndex = '11';
                        toast.innerHTML = `
                            <div class="toast show" role="alert" aria-live="assertive" aria-atomic="true">
                                <div class="toast-header bg-danger text-white">
                                    <strong class="me-auto">Error</strong>
                                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast" aria-label="Close"></button>
                                </div>
                                <div class="toast-body">
                                    Minimum quantity is 10. Remove item if you don't want it.
                                </div>
                            </div>
                        `;
                        document.body.appendChild(toast);
                        
                        setTimeout(() => {
                            toast.remove();
                        }, 3000);
                    }
                }
                
                if (e.target.classList.contains('increase-quantity') || e.target.closest('.increase-quantity')) {
                    const button = e.target.classList.contains('increase-quantity') ? e.target : e.target.closest('.increase-quantity');
                    const productId = parseInt(button.getAttribute('data-id'));
                    const item = cart.find(item => item.id === productId);
                    
                    if (item) {
                    item.quantity += 1;
                    localStorage.setItem('cart', JSON.stringify(cart));
                    renderCartItems();

                    } else {
                        // Show error message for maximum quantity
                        const toast = document.createElement('div');
                        toast.className = 'position-fixed bottom-0 end-0 p-3';
                        toast.style.zIndex = '11';
                        toast.innerHTML = `
                            <div class="toast show" role="alert" aria-live="assertive" aria-atomic="true">
                                <div class="toast-header bg-danger text-white">
                                    <strong class="me-auto">Error</strong>
                                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast" aria-label="Close"></button>
                                </div>
                            
                            </div>
                        `;
                        document.body.appendChild(toast);
                        
                        setTimeout(() => {
                            toast.remove();
                        }, 3000);
                    }
                }
                
                if (e.target.classList.contains('remove-item') || e.target.closest('.remove-item')) {
                    const button = e.target.classList.contains('remove-item') ? e.target : e.target.closest('.remove-item');
                    const productId = parseInt(button.getAttribute('data-id'));
                    cart = cart.filter(item => item.id !== productId);
                    localStorage.setItem('cart', JSON.stringify(cart));
                    renderCartItems();
                }

                // Render order history in #accountOrderHistory
                const historyContainer = document.getElementById('accountOrderHistory');
                if (historyContainer) {
                    const allOrders = JSON.parse(localStorage.getItem('orders')) || [];
                    const completedOrders = allOrders.filter(o => o.status === 'Completed');

                    if (completedOrders.length === 0) {
                        historyContainer.innerHTML = `
                            <div class="text-center py-4">
                                <i class="fas fa-clock fa-3x text-muted mb-3"></i>
                                <p class="text-muted">No orders yet</p>
                                <a href="index.html#flavors" class="btn btn-outline-primary">
                                    <i class="fas fa-ice-cream me-2"></i> Start Shopping
                                </a>
                            </div>
                        `;
                    } else {
                        historyContainer.innerHTML = completedOrders.reverse().map(order => `
                        <div class="mb-3 border rounded p-3">
                            <h6>Order ID: ${order.id}</h6>
                            <div class="d-flex flex-wrap gap-3">
                                ${order.items.map(i => `
                                    <div class="d-flex align-items-center gap-2 border p-2 rounded">
                                        <img src="images/${i.image}" alt="${i.name}" width="40" height="40" style="object-fit:cover; border-radius:6px;">
                                        <div>
                                            <div><strong>${i.name}</strong></div>
                                            <div>Qty: ${i.quantity}</div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                            <div class="mt-2">Total: ₹${order.total.toFixed(2)}</div>
                            <div>Paid via: ${order.paymentMethod || '-'}</div>
                            <div>Date: ${new Date(order.paymentDate).toLocaleString()}</div>
                        </div>
                    `).join('');

                    }
                }

            });
            
            // Checkout button with animation
           document.getElementById('accountCheckoutBtn').addEventListener('click', function () {
    if (cart.length === 0) return;

    if (!user.phone || !user.address) {
        const toast = document.createElement('div');
        toast.className = 'position-fixed bottom-0 end-0 p-3';
        toast.style.zIndex = '11';
        toast.innerHTML = `
            <div class="toast show" role="alert" aria-live="assertive" aria-atomic="true">
                <div class="toast-header bg-danger text-white">
                    <strong class="me-auto">Error</strong>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast" aria-label="Close"></button>
                </div>
                <div class="toast-body">
                    Please update your phone number and address before checkout.
                </div>
            </div>
        `;
        document.body.appendChild(toast);
        setTimeout(() => { toast.remove(); }, 3000);
        document.getElementById('accountDetailsView').style.display = 'none';
        document.getElementById('accountDetailsEdit').style.display = 'block';
        initEditMode();
        return;
    }
              const subtotal = cart.reduce((sum, item) => sum + item.price * item.quantity, 0);
    const tax = subtotal * 0.10;
    const serviceCharge = 15;
    const total = subtotal + tax + serviceCharge;
    const order = {
        id: Date.now(),
        items: cart,
        subtotal,
        tax,
        total
    };
                
               // ✅ Redirect to payment.html
    const orderEncoded = encodeURIComponent(JSON.stringify(order));
    const userEncoded = encodeURIComponent(JSON.stringify(user));
    window.location.href = `payment.html?order=${orderEncoded}&user=${userEncoded}`;

                
                // Simulate payment processing
                setTimeout(() => {
                    // Calculate order total
                    const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                    const tax = subtotal * 0.1;
                    const serviceCharge = 15;
                    const total = subtotal + tax + serviceCharge;
                    
                    // Create order
                    const order = {
                        id: 'ORD-' + Math.floor(100000 + Math.random() * 900000),
                        date: new Date().toISOString(),
                        items: [...cart],
                        subtotal: subtotal,
                        tax: tax,
                        serviceCharge: serviceCharge,
                        total: total,
                        status: 'Processing',
                        address: user.address,
                        userEmail: user.email
                    };

                    
                    
                    // Save order
                    const allOrders = JSON.parse(localStorage.getItem('orders')) || [];
                    allOrders.unshift(order);
                    localStorage.setItem('orders', JSON.stringify(allOrders));
                    
                    // Update orders list for current user
                    orders = allOrders.filter(o => o.userEmail === user.email);
                    
                    // Clear cart
                    localStorage.removeItem('cart');
                    cart = [];
                    
                    // Show success animation
                    clearInterval(flipInterval);
                    btn.classList.remove('processing-payment');
                    paymentAnimation.style.display = 'none';
                    paymentSuccess.style.display = 'inline-flex';
                    btn.classList.add('payment-success', 'payment-complete');
                    
                    // Reset after animation
                    setTimeout(() => {
                        renderCartItems();
                        renderOrderHistory();
                        
                        // Reset button state after delay
                        setTimeout(() => {
                            buttonContent.style.display = 'inline-flex';
                            paymentSuccess.style.display = 'none';
                            btn.classList.remove('payment-success', 'payment-complete');
                            btn.disabled = false;
                        }, 2000);
                    }, 1500);
                }, 4000); // Processing time to show animations
            });
            
            // Confirm address
            document.getElementById('confirmAddressBtn').addEventListener('click', function() {
                const address = document.getElementById('deliveryAddress').value;
                if (!address) {
                    document.getElementById('deliveryAddress').classList.add('is-invalid');
                    return;
                }
                
                user.address = address;
                localStorage.setItem('loggedInUser', JSON.stringify(user));
                updateUserInfo();
                
                const addressModal = bootstrap.Modal.getInstance(document.getElementById('addressModal'));
                addressModal.hide();
                
                // Trigger checkout
                document.getElementById('accountCheckoutBtn').click();
            });
            
            // Logout button
            document.getElementById('logoutBtn').addEventListener('click', function() {
                localStorage.removeItem('loggedInUser');
                window.location.href = 'index.html';
            });
            
            // Edit profile button
            document.getElementById('editProfileBtn').addEventListener('click', function() {
                document.getElementById('accountDetailsView').style.display = 'none';
                document.getElementById('accountDetailsEdit').style.display = 'block';
                initEditMode();
            });
            
            // Change photo button
            document.getElementById('changePhotoBtn').addEventListener('click', function() {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = 'image/*';
                
                input.onchange = e => {
                    const file = e.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = event => {
                            document.getElementById('accountUserImg').src = event.target.result;
                            user.image = event.target.result;
                            localStorage.setItem('loggedInUser', JSON.stringify(user));
                        };
                        reader.readAsDataURL(file);
                    }
                };
                
                input.click();
            });
            
           
            
            // View order details
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('view-order-details') || e.target.closest('.view-order-details')) {
                    const button = e.target.classList.contains('view-order-details') ? e.target : e.target.closest('.view-order-details');
                    const orderId = button.getAttribute('data-id');
                    const order = orders.find(o => o.id === orderId);
                    
                    if (order) {
                        let html = `
                            <div class="mb-4">
                                <h6>Order #${order.id}</h6>
                                <p class="text-muted small">Placed on ${new Date(order.date).toLocaleString()}</p>
                                <p class="mb-2"><strong>Status:</strong> <span class="badge ${order.status === 'Delivered' ? 'bg-success' : order.status === 'Cancelled' ? 'bg-danger' : 'bg-warning text-dark'}">${order.status}</span></p>
                                <p class="mb-2"><strong>Delivery Address:</strong> ${order.address || user.address || 'Not specified'}</p>
                            </div>
                            
                            <h6 class="mb-3">Order Items</h6>
                        `;
                        
                        order.items.forEach(item => {
                            html += `
                                <div class="order-item">
                                    <img src="${item.image}" alt="${item.name}" class="order-item-img">
                                    <div class="flex-grow-1">
                                        <h6>${item.name}</h6>
                                        <p class="text-muted">Quantity: ${item.quantity}</p>
                                        <p class="text-primary fw-bold">₹${item.price.toFixed(2)} each</p>
                                    </div>
                                    <div class="text-end">
                                        <p class="fw-bold">₹${(item.price * item.quantity).toFixed(2)}</p>
                                    </div>
                                </div>
                            `;
                        });
                        
                        html += `
                            <div class="mt-4 pt-3 border-top">
                                <div class="row">
                                    <div class="col-md-6">
                                        <p>Subtotal:</p>
                                        <p>Tax (10%):</p>
                                        <p>Service Charge:</p>
                                        <p class="fw-bold">Total:</p>
                                    </div>
                                    <div class="col-md-6 text-end">
                                        <p>₹${order.subtotal.toFixed(2)}</p>
                                        <p>₹${order.tax.toFixed(2)}</p>
                                        <p>₹${order.serviceCharge.toFixed(2)}</p>
                                        <p class="fw-bold">₹${order.total.toFixed(2)}</p>
                                    </div>
                                </div>
                            </div>
                        `;
                        
                        document.getElementById('orderDetailsContent').innerHTML = html;
                        const orderDetailsModal = new bootstrap.Modal(document.getElementById('orderDetailsModal'));
                        orderDetailsModal.show();
                    }
                }
                
            });
        });
    </script>
</body>
</html>